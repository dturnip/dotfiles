"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{37811:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>G,default:()=>X});var a=n(59713),r=n.n(a),l=n(20657),i=n(67294),s=n.n(i),o=n(30947),c=n(55911),u=n(20246),d=n(43620),m=n(67379),p=n(6479),f=n.n(p),b=n(47991),v=n(56705),y=n(80624),g=n(98269),h=n(94967),k=n(69518),I=n.n(k),E=n(9273),w=n(36447);const x=["pageItems"];function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e){const t=(0,E._)(),{isEnhanced:n,iteration:a,setIsEnhanced:r,toggleIsEnhanced:l}=(0,w.U)(e),[s,o]=(0,i.useState)(null),c=(0,i.useRef)({}),u=(0,i.useRef)(null),d=(0,i.useMemo)((()=>new h.Ct),[]),m=(0,i.useMemo)((()=>new h.tL),[]),p=(0,i.useCallback)((async e=>{const t=Array.from(new Set(e.map((e=>e.uri)))).filter((e=>!d.has(e)));return(await(0,v.s)(t,(async e=>{const t=e.map((e=>I().from(e).getBase62Id())),{body:n}=await m.create(t.join(","),(()=>g.fQ.getTracks(y.b.getInstance(),t)));return n.tracks}))).flat().forEach((e=>d.set((0,b.$V)(e),e))),n=d,e.map((e=>{var t;return P(P({},n.get(e.uri)),{},{uid:null==e?void 0:e.itemId,isEnhanced:null==e||null===(t=e.itemAttributes)||void 0===t?void 0:t.isRecommendation})}));var n}),[d,m]),k=(0,i.useCallback)((async(e,n,a,r,l,i)=>{var s,d,m,b,v,y,g;const h=null===(s=u.current)||void 0===s?void 0:s.stateId;let k;try{k=await i}catch(l){409===(null==l?void 0:l.status)&&(k=await t.getPage(e,n,a,r))}const I=null===(d=k)||void 0===d?void 0:d.enhancePage;if(!I)return[];const{pageItems:E}=I,w=f()(I,x),O=await p(E);if(h!==(null===(m=u.current)||void 0===m?void 0:m.stateId))return[];const C=(null===(b=u.current)||void 0===b?void 0:b.contextRevision)!==w.contextRevision,R=(null===(v=u.current)||void 0===v?void 0:v.sessionId)!==w.sessionId;(C||R)&&(l=!0),c.current=function(e,t,n,a){const r=a?{}:P({},e);return t.forEach(((e,t)=>{r[n+t]=e})),r}(c.current,O,a,l);const j=(null!==(y=null===(g=u.current)||void 0===g?void 0:g.stateId)&&void 0!==y?y:1)+(l?1:0),T=P(P({},w),{},{stateId:j});return o(T),u.current=T,O}),[p,t]),O=(0,i.useCallback)((async({itemIds:n,offset:r=0,limit:l=1})=>{u.current&&a&&k(e,a,r,l,!0,t.addRecommendation(e,u.current.sessionId,u.current.contextRevision,n,r,l))}),[k,e,t,a]),C=(0,i.useCallback)((async({itemIds:n,offset:r=0,limit:l=1})=>{u.current&&a&&k(e,a,r,l,!0,t.removeRecommendation(e,u.current.sessionId,u.current.contextRevision,n,r,l))}),[k,e,t,a]),R=(0,i.useCallback)((async(n,r)=>{var l;if(!a)return[];const i=Math.min(r,((null===(l=u.current)||void 0===l?void 0:l.numTotalItems)||1/0)-n),s=Array.from({length:i},((e,t)=>c.current[t+n]));return s.every((e=>!!e))?s:k(e,a,n,r,!1,t.getPage(e,a,n,r))}),[k,e,t,a]);return{isEnhanced:n,setIsEnhanced:r,toggleIsEnhanced:l,addRecommendation:O,removeRecommendation:C,playContext:(0,i.useMemo)((()=>({uri:e,url:null==s?void 0:s.dspContextUri})),[e,null==s?void 0:s.dspContextUri]),numTotalItems:isNaN(Number(null==s?void 0:s.numTotalItems))?void 0:Number(null==s?void 0:s.numTotalItems),numTotalRecs:isNaN(Number(null==s?void 0:s.numTotalRecs))?void 0:Number(null==s?void 0:s.numTotalRecs),fetchTracks:R,stateId:null==s?void 0:s.stateId}}var R=n(84242),j=n(95661),T=n(35410),N=n(70369),D=n(55120),M=n(83979);const S={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"DQynpBhCEl3bw8GYk_Nm",playlistImageContainer:"q9adg9GBqIbhHAsBfoCM"};var L=n(42922),U=n(49961),_=n(35308),A=n(28248),Q=n(73785);const B=[Q.Q.INDEX,Q.Q.TITLE,Q.Q.ALBUM,Q.Q.DURATION],q=s().memo((function({ariaLabel:e,uri:t,name:n,usePlayContextItem:a,tracklistRef:r,fetchTracks:o,addRecommendation:c,removeRecommendation:u,nrTracks:d}){const m=(0,i.useRef)((()=>{})),[p,f]=(0,i.useState)([]),b=(0,i.useCallback)((()=>{var e;const{firstIndex:t,lastIndex:n}=null==r||null===(e=r.current)||void 0===e?void 0:e.getVisibleTrackWindow(),a=n-t;return Math.max(0,t-Math.round((50-a)/2))}),[r]),v=(0,i.useCallback)((e=>{m.current(),u({itemIds:e.map((({id:e})=>e)),offset:b(),limit:50})}),[u,b]),y=(0,i.useCallback)(((e,t)=>{m.current=t,e.length>1?f(e):v(e)}),[v]),g=(0,i.useCallback)((e=>{c({itemIds:[e],offset:b(),limit:50})}),[c,b]),h=(0,i.useCallback)((e=>{u({itemIds:[e],offset:b(),limit:50})}),[u,b]),k=(0,i.useCallback)((function(e,n){const r=(0,U.X)(e.album.images,{desiredSize:40,desiredLabel:"small"});return s().createElement(A.jN,{key:e.uid,index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.is_playable,durationMs:e.duration_ms,name:e.name,artists:e.artists,album:e.album,isExplicit:e.explicit,isMOGEFRestricted:!!e.mogef19,imgUrl:(null==r?void 0:r.url)||"",usePlayContextItem:a,isEnhanced:e.isEnhanced,add:g,remove:h})}),[a,t,g,h]),I=(0,i.useCallback)((e=>e.uri),[]),E=(0,i.useCallback)((e=>e.uid),[]);return s().createElement(s().Fragment,null,s().createElement(L.ZP,{value:"playlist-tracklist"},s().createElement(A.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:e,hasHeaderRow:!0,columns:B,onRemove:y,renderRow:k,resolveUri:I,resolveUid:E,nrTracks:d,fetchTracks:o,limit:50,outerRef:r})),s().createElement(_.h,{title:l.ag.get("playlist.remove_from_playlist",n),isOpen:p.length>0,tracks:p,onClose:e=>{e.stopPropagation(),f([])},onRemove:v}))}));function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const G=s().memo((function({metadata:e}){const{uri:t,name:n,images:a,totalLength:r,canPlay:p}=e,[f]=a,b=(0,d.Z)((null==f?void 0:f.url)||null),v=(0,i.useRef)(null),{playContext:y,numTotalItems:g,addRecommendation:h,removeRecommendation:k,fetchTracks:I,stateId:E}=C(t);(0,i.useEffect)((()=>{var e;E&&(null===(e=v.current)||void 0===e||e.update())}),[E]);const{isPlaying:w,togglePlay:x,usePlayContextItem:O}=(0,R.n)(y,{featureIdentifier:"playlist"}),P=(0,i.useCallback)((()=>x()),[x]);return s().createElement(i.Suspense,{fallback:null},s().createElement(N.$,null,l.ag.get("playlist.page-title",n)),s().createElement("section",{role:"presentation",className:S.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},s().createElement(M.s,{metadata:F(F({},e),{},{duration:null,totalLength:null!=g?g:r}),isPlaying:w,togglePlay:P,backgroundColor:b}),s().createElement("div",{className:S.playlistContent},s().createElement(o.o,{backgroundColor:b},s().createElement(o.F,null,p?s().createElement(D.$,{onClick:P,isPlaying:w,size:c.qE.lg,uri:t}):null,s().createElement(m.v,{uri:t}),s().createElement(u.y,{menu:s().createElement(T.X,{uri:t})},s().createElement(j.z,null))))),s().createElement("div",{className:"contentSpacing"},s().createElement(i.Suspense,{fallback:null},s().createElement(q,{key:t,ariaLabel:n,nrTracks:null!=g?g:Math.max(15,r),uri:t,name:n,usePlayContextItem:O,tracklistRef:v,fetchTracks:I,addRecommendation:h,removeRecommendation:k})))))})),X=G}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map