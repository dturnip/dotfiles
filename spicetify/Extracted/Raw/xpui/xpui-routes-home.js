"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[807],{83590:(e,t,n)=>{n.r(t),n.d(t,{HOME_REFRESH_TIMEOUT:()=>O,default:()=>C});var s=n(67294),a=n.n(s),o=n(94184),r=n.n(o),i=n(65858),c=n(76092),l=n(18886),u=n(1663),d=n(20657),f=n(79834),m=n(29255),_=n(5001),g=n(89294),p=n(92457),E=n(70369),v=n(13983),y=n(35808),h=n(17231),S=n(8247),w=n(24872),b=n(35533),I=n(33607),A=n(80624),T=n(74845),P=n(23716);const L="PLAY_AT_FIRST_TAP_HAD_DEFERRED_ACTIONS",R=e=>{const t=(0,w.getEventSenderInstance)(),n=(0,b.x)(e);t.send(n)};function N(e){const t=(0,h.W6)(S.Qs),[n,a]=(0,s.useState)(void 0),[o,r]=(0,s.useState)(void 0),[c,l]=(0,s.useState)(!1),u=(0,P.g)(),d=(0,i.v9)((({session:e})=>e.user&&e.user.id));(0,s.useEffect)((()=>{r(!!window.sessionStorage.getItem(L)&&(window.sessionStorage.removeItem(L),!0))}),[]),(0,s.useEffect)((()=>{d&&(R({category:"play-at-first-tap",label:"log_attempt",os:(0,I.y)(),context:"ab_v3"}),l((e=>!!window.sessionStorage.getItem(`PLAY_AT_FIRST_TAP_APPLIED_${e}`))(d)),(0,T.M)(A.b.getInstance()).then((e=>{a(e.content.items.length>0)})).catch((()=>{R({category:"play-at-first-tap",label:"recently-played-failed",os:(0,I.y)(),context:"ab_v3"}),a(!0)})))}),[d]),(0,s.useEffect)((()=>{if(void 0===n||void 0===o||!e||!d||c)return;const s=!n&&!o;if(s){(e=>{window.sessionStorage.setItem(`PLAY_AT_FIRST_TAP_APPLIED_${e}`,JSON.stringify(!0))})(d);const n=(e=>{const t=e.content.items.find((e=>{const t="CAROUSEL"===e.rendering,n="LIST"===e.rendering&&"shortcuts"!==e.id;return t||n}));if(!t)return;const n=t.content.items.find((e=>!e.publisher||!e.publisher.startsWith("Spotify")));return n&&n.uri})(e);n&&t&&u.play({uri:n},{featureIdentifier:"home",referrerIdentifier:"home"},{paused:!0}),R({category:"play-at-first-tap",label:"play_content",os:(0,I.y)(),context:n||"no_valid_uri_retrieved"})}R({category:"play-state",label:s?"has_valid_state_yes":"has_valid_state_no",os:(0,I.y)(),context:"ab_v3"})}),[c,n,e,o,u,d,t])}const O=18e5,C=a().memo((()=>{const{isAnonymous:e}=(0,i.v9)(m.Gg),{status:t}=(0,p.h)(g.N9.SIGNUP),n=(0,_.v8)(e,t===g.b_.COMPLETE),{view:o,refreshContents:h}=(0,y.P)(n);(0,v.z)("home"),N(o);const S=(null==o?void 0:o.timestamp)||0;(0,s.useEffect)((()=>{const e=()=>{Date.now()>S+O&&h()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[S,h]);const w=null==o?void 0:o.content.items;return a().createElement(a().Fragment,null,a().createElement(E.$,null,d.ag.get("page.generic-title")),a().createElement(s.Suspense,{fallback:null},a().createElement(l.SearchOnHomeTopBar,null)),o?a().createElement("section",{"data-testid":"home-page"},a().createElement("div",{className:c.Z.home},a().createElement("div",{className:r()(c.Z.content,"contentSpacing")},a().createElement(f.c,{spaces:w,viewName:o.name,viewId:n,isAnonymous:e})))):a().createElement(u.h,{errorMessage:d.ag.get("error.not_found.title.page")}))}))}}]);
//# sourceMappingURL=xpui-routes-home.js.map